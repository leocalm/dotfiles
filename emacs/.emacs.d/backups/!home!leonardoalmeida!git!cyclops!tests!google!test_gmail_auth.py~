import json
from unittest.mock import patch
import google.gmail_authentication as gmail_authentication


def test_get_auth_utl(db):
    gmail_authentication.db = db
    url = gmail_authentication.get_authorization_url()
    assert 'https://accounts.google.com/o/oauth2/' in url


class credential:
    def to_json(self):
        return json.dumps({'credential': 'a'})

    def __repr__(self):
        return {'credential': 'a'}


def mock_step2(self, code):
    return credential()


@patch('oauth2client.client.OAuth2WebServerFlow.step2_exchange', mock_step2)
def test_authorize(db):
    cred = gmail_authentication.authorize('')
    assert cred == {'credential': 'a'}
